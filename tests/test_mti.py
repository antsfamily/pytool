import time
import pytool as pt
import numpy as np
from numpy.fft import fft, fftshift
from matplotlib import pyplot as plt


M = 65
N = 100

Coefs = [
    -9.478321206422e-08, 6.750125126845e-07, -
    2.59289850631e-06, 6.755755419281e-06,
    -1.247341466092e-05, 1.460421798339e-05, -
    1.48576140806e-06, -4.211109516121e-05,
    0.0001227357564053, -
    0.0002175406707933, 0.0002563583843966, -0.0001282001561017,
    -0.0002666409193456, 0.0009188052217388, -
    0.001606787547624, 0.001868816845159,
    -0.001134803973861, -
    0.0009558845233327, 0.004145181390614, -0.007278177857943,
    0.008426599757458, -0.005575526934688, -
    0.002234625870299,  0.01374614107921,
    -0.02493965777155,  0.02965185045915, -
    0.02146584796369, -0.003642452597165,
    0.04494092268993, -0.09600580794454,   0.1459098007126,  -0.1823619477096,
    0.195726824381,  -0.1823619477096,   0.1459098007126, -0.09600580794454,
    0.04494092268993, -0.003642452597165, -0.02146584796369,  0.02965185045915,
    -0.02493965777155,  0.01374614107921, -
    0.002234625870299, -0.005575526934688,
    0.008426599757458, -0.007278177857943, 0.004145181390614, -
    0.0009558845233327,
    -0.001134803973861, 0.001868816845159, -
    0.001606787547624, 0.0009188052217388,
    -0.0002666409193456, -
    0.0001282001561017, 0.0002563583843966, -0.0002175406707933,
    0.0001227357564053, -4.211109516121e-05, -
    1.48576140806e-06, 1.460421798339e-05,
    -1.247341466092e-05, 6.755755419281e-06, -
    2.59289850631e-06, 6.750125126845e-07,
    -9.478321206422e-08
]
nTaps = M

ptime = 1

PI = np.pi
Fsa = 100.0
Nsa = 65 * 10
Tsa = Nsa / Fsa

t = np.linspace(0, Tsa, Nsa)

id1 = range(0, 8, 2)
id2 = range(1, 8, 2)
print(t[id1], t[id2])


t = np.reshape(t, (Nsa, 1))
f = np.linspace(-Fsa / 2.0, Fsa / 2.0, N)
f = np.reshape(f, (N, 1))

A = np.ones((Nsa, N)) * 1.0e4

XX = A * np.sin(2.0 * PI * np.matmul(t, f.transpose()))

X = np.zeros((M, N))

S = pt.mti_init(Coefs, nTaps)


plt.ion()
plt.figure(1)

for x in XX:
    plt.clf()

    y = pt.slide_mti(S, X, x)
    print(y.shape, y.min(), y.max())

    plt.subplot(121)
    plt.plot(y)
    plt.grid()

    y = fftshift(fft(fftshift(y)))

    plt.subplot(122)
    plt.plot(np.abs(y))
    plt.grid()

    plt.pause(ptime)

plt.ioff()
